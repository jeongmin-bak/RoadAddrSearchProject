<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <title>HW1</title>
    <!-- Naver map open API -->
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=f0g29hw3k3&submodules=geocoder"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet"/>
    <!-- 외부 스타일 시트를 링크합니다. -->
    <link href="/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

    <!-- Bootstrap js-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script crossorigin="anonymous"
            integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g="
            src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>

    <script src="/js/basic.js"></script>

    <!-- layout include js -->
    <script src="/js/layout.js"></script>
    <!-- user token include js -->
    <script src="/js/checkToken.js"></script>
</head>
<body>
<!-- Responsive navbar-->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark" data-include-path="nav.html">
</nav>
<!-- Page Content-->
<section class="py-5">
    <div class="container px-5 my-5">
        <div class="text-center mb-5">
            <h1 class="fw-bolder">사용자 검색 기록</h1>
            <p class="lead fw-normal text-muted mb-0">도로명 주소 검색 기록 관리 페이지</p>
        </div>
        <div class="row gx-5">
<!--            <div class="col-xl-8">-->
<!--                &lt;!&ndash; FAQ Accordion 1&ndash;&gt;-->
<!--                <h2 class="fw-bolder mb-3">검색어</h2>-->
<!--                <div class="accordion mb-5" id="accordionExample">-->
<!--                    <div class="accordion-item">-->
<!--                        <h3 class="accordion-header" id="headingOne"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Accordion Item #1</button></h3>-->
<!--                        <div class="accordion-collapse collapse show" id="collapseOne" aria-labelledby="headingOne" data-bs-parent="#accordionExample">-->
<!--                            <div class="accordion-body">-->
<!--                                <strong>This is the first item's accordion body.</strong>-->
<!--                                It is shown by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the-->
<!--                                <code>.accordion-body</code>-->
<!--                                , though the transition does limit overflow.-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="accordion-item">-->
<!--                        <h3 class="accordion-header" id="headingTwo"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Accordion Item #2</button></h3>-->
<!--                        <div class="accordion-collapse collapse" id="collapseTwo" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">-->
<!--                            <div class="accordion-body">-->
<!--                                <strong>This is the second item's accordion body.</strong>-->
<!--                                It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the-->
<!--                                <code>.accordion-body</code>-->
<!--                                , though the transition does limit overflow.-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="accordion-item">-->
<!--                        <h3 class="accordion-header" id="headingThree"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Accordion Item #3</button></h3>-->
<!--                        <div class="accordion-collapse collapse" id="collapseThree" aria-labelledby="headingThree" data-bs-parent="#accordionExample">-->
<!--                            <div class="accordion-body">-->
<!--                                <strong>This is the third item's accordion body.</strong>-->
<!--                                It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the-->
<!--                                <code>.accordion-body</code>-->
<!--                                , though the transition does limit overflow.-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="col-xl-4">-->
<!--                <div class="card border-0 bg-light mt-xl-5">-->
<!--                    <div class="card-body p-4 py-lg-5">-->
<!--                        <div class="d-flex align-items-center justify-content-center">-->
<!--                            <div class="text-center">-->
<!--                                <div class="h6 fw-bolder">Have more questions?</div>-->
<!--                                <p class="text-muted mb-4">-->
<!--                                    Contact us at-->
<!--                                    <br />-->
<!--                                    <a href="#!">support@domain.com</a>-->
<!--                                </p>-->
<!--                                <div class="h6 fw-bolder">Follow us</div>-->
<!--                                <a class="fs-5 px-2 link-dark" href="#!"><i class="bi-twitter"></i></a>-->
<!--                                <a class="fs-5 px-2 link-dark" href="#!"><i class="bi-facebook"></i></a>-->
<!--                                <a class="fs-5 px-2 link-dark" href="#!"><i class="bi-linkedin"></i></a>-->
<!--                                <a class="fs-5 px-2 link-dark" href="#!"><i class="bi-youtube"></i></a>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
            <table class="table" id="user-search-history">
                <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">검색어</th>
                    <th scope="col">최근검색일자</th>
                    <th scope="col">검색횟수</th>
                    <th scope="col" id="btn-drop-history">#</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th scope="row">1</th>
                    <td>${data.searchJuso}</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
</section>
<!--footer-->
<footer class="bg-dark py-4 mt-auto">
</footer>
</body>
<script>
    const authToken = getAuthorizationToken();

    $(document).ready(userAddrSearchHistory());

    function userAddrSearchHistory(){
        $.ajax({
            type : "GET",
            url : "/check/user/search/history",
            headers:{
                'Authorization': authToken
            },
            dataType : 'json',
            success:
                function (data) {
                    $('tbody tr').empty();
                    for (let i = 0; i < data.length; i++) {
                        let tempHtml = addHTML(data[i], i+1)
                        $('tbody').append(tempHtml);
                    }
                }
            ,

        })
    }

    function addHTML(data, index){
        return `<tr id="user-history-"${index}>
                      <th scope="row">${index}</th>
                      <td><a href="#" onclick="showSearchAddr(this)">${data.searchJuso}</a></td>
                      <td>${data.searchTime}</td>
                      <td>${data.searchCount}</td>
                      <td><button type="button" class="btn btn-secondary" onclick="deleteUserSearchHistory(this)">기록삭제</button></td>
                 </tr>
                `
    }

    function showSearchAddr(ele){
        juso = ele.textContent;
        $.ajax({
            url: "/juso/search/list",
            type: "POST",
            dataType : "json",
            data: JSON.stringify({
                juso: juso
            }),
            contentType : "application/json",
            success: function (response) {
                console.log("Success!");
                window.location.href = "/juso/search";
                localStorage.setItem("searchAddr", juso)
            },
            error: function (xhr, status, error) {
                console.error("Error:", error);
            }
        });
    }

    function deleteUserSearchHistory(ele){
        let row = ele.parentNode.parentNode;
        let cells = row.getElementsByTagName("td");
        let searchJuso = cells[0].innerText;

        $.ajax({
            url: "/delete/juso/search/history",
            type: "POST",
            headers:{
                'Authorization': authToken
            },
            data: JSON.stringify({
                searchAddr: searchJuso
            }),
            contentType: 'application/json',
            success: function (response) {
                console.log("delete Success!");
                userAddrSearchHistory();
            },
            error: function (xhr, status, error) {
                console.error("Error:", error);
            }
        });
    }
</script>
</html>